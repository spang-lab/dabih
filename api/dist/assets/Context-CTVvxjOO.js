import{r as c,R as v,P as g,j as l,I as q,u as G,b as S,a as b,c as C}from"./index-D81WwACb.js";import{u as J,a as $,b as Q,K as X,P as Y}from"./core.esm-DQkDfR73.js";import{C as Z}from"./copy-BIumn5ZQ.js";import{T as ee}from"./trash-2-DYQ5HbAl.js";function _(){return _=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},_.apply(this,arguments)}function te(e,n){if(e==null)return{};var s=re(e,n),r,t;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}function re(e,n){if(e==null)return{};var s={},r=Object.keys(e),t,a;for(a=0;a<r.length;a++)t=r[a],!(n.indexOf(t)>=0)&&(s[t]=e[t]);return s}var M=c.forwardRef(function(e,n){var s=e.color,r=s===void 0?"currentColor":s,t=e.size,a=t===void 0?24:t,m=te(e,["color","size"]);return v.createElement("svg",_({ref:n,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},m),v.createElement("path",{d:"M12 20h9"}),v.createElement("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"}))});M.propTypes={color:g.string,size:g.oneOfType([g.string,g.number])};M.displayName="Edit3";function z(){return z=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},z.apply(this,arguments)}function ne(e,n){if(e==null)return{};var s=se(e,n),r,t;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}function se(e,n){if(e==null)return{};var s={},r=Object.keys(e),t,a;for(a=0;a<r.length;a++)t=r[a],!(n.indexOf(t)>=0)&&(s[t]=e[t]);return s}var F=c.forwardRef(function(e,n){var s=e.color,r=s===void 0?"currentColor":s,t=e.size,a=t===void 0?24:t,m=ne(e,["color","size"]);return v.createElement("svg",z({ref:n,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},m),v.createElement("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"}),v.createElement("line",{x1:"12",y1:"11",x2:"12",y2:"17"}),v.createElement("line",{x1:"9",y1:"14",x2:"15",y2:"14"}))});F.propTypes={color:g.string,size:g.oneOfType([g.string,g.number])};F.displayName="FolderPlus";function D(){const{menu:e,setMenu:n,selected:s,addFolder:r,remove:t}=W(),a=s.length===0,m=s.length===1,h=c.useRef(null),x={left:e.left,top:e.top},p=k=>{const O=k.target,w=h.current;w&&!w.contains(O)&&n({top:0,left:0,open:!1})};c.useEffect(()=>(document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}),[]);const d=()=>{t(),n({top:0,left:0,open:!1})},j=()=>{r(),n({top:0,left:0,open:!1})};return e.open?l.jsx("div",{ref:h,children:l.jsxs("div",{className:"w-52 z-10 absolute rounded-sm border border-gray-300 bg-white p-1 text-sm/6 text-blue transition duration-100 ease-out [--anchor-gap:var(--spacing-1)] focus:outline-hidden data-closed:scale-95 data-closed:opacity-0",style:x,children:[l.jsx("div",{children:l.jsxs("button",{onClick:j,className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 hover:bg-blue/40",children:[l.jsx(F,{className:"text-blue"}),"New Folder"]})}),l.jsx("div",{children:l.jsxs("button",{disabled:a,className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 hover:bg-blue/40 disabled:bg-white disabled:text-blue/40",children:[l.jsx(q,{}),"Download"]})}),l.jsx("div",{children:l.jsxs("button",{disabled:!m,className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 hover:bg-blue/40 disabled:bg-white disabled:text-blue/40",children:[l.jsx(M,{}),"Rename"]})}),l.jsx("div",{children:l.jsxs("button",{disabled:!m,className:"group flex w-full items-center gap-2 rounded-lg py-1.5 px-3 hover:bg-blue/40 disabled:bg-white disabled:text-blue/40",children:[l.jsx(Z,{}),"Duplicate"]})}),l.jsx("div",{className:"my-1 h-px bg-gray-300"}),l.jsx("div",{children:l.jsxs("button",{onClick:d,disabled:a,className:"group flex w-full items-center text-red gap-2 rounded-lg py-1.5 px-3 hover:bg-blue/40 disabled:bg-white disabled:text-red/40",children:[l.jsx(ee,{}),"Delete"]})})]})}):null}const de=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"})),R=c.createContext({});function oe({children:e}){const{key:n}=G(),[s,r]=c.useState({}),[t,a]=c.useState([]),[m,h]=c.useState({left:0,top:0,open:!1}),x=S(o=>o.nodes),p=S(o=>o.cwd),d=S(o=>o.list),j=c.useCallback(async()=>{const{data:o,error:i}=await b.user.list();if(i||!o){console.error(i);return}const u=o.reduce((f,y)=>(f[y.sub]=y,f),{});r(u)},[]),k=c.useCallback(async o=>{const{data:i,error:u}=await b.fs.listFiles(o);if(!i||u){console.error(u);return}if(!n){console.error("No key available for decryption");return}const f=i.map(async P=>{const E=await C.file.decryptKey(n,P);return{mnemonic:P.mnemonic,key:await C.aesKey.toBase64(E)}});return await Promise.all(f)},[n]),O=c.useCallback(async()=>{let o="untitled_folder",i=1;for(;x.find(u=>u.name===o);)o=`untitled_folder_${i}`,i+=1;await b.fs.addDirectory(o,p??void 0),await d(p)},[p,x,d]),w=c.useCallback(async(o,i)=>{const u=await k(o);u&&(await b.fs.addMember(o,{subs:[i],keys:u}),await d(p))},[k,p,d]),N=c.useCallback(async()=>{const o=t.map(async i=>{await b.fs.remove(i)});await Promise.all(o),await d(p)},[d,t,p]),L=c.useCallback(async(o,i)=>{await b.fs.move({mnemonic:o,name:i}),await d(p)},[d,p]),K=c.useCallback(async(o,i)=>{if(!i){const f=o.map(async y=>{await b.fs.move({mnemonic:y,parent:null})});await Promise.all(f),await d(p);return}const u=o.map(async f=>{if(f===i)return;const{data:y,error:P}=await b.fs.listFiles(f);if(!y||P||!n)return;const E=y.map(async T=>{const V=await C.file.decryptKey(n,T);return{mnemonic:T.mnemonic,key:await C.aesKey.toBase64(V)}}),H=await Promise.all(E);await b.fs.move({mnemonic:f,parent:i,keys:H}),await d(p)});await Promise.all(u)},[n,p,d]),B=c.useCallback(o=>{const i=o.active.id,u=i.split("-",2)[1];if(!u)throw new Error(`Invalid drag id ${i}`);t.includes(u)||a([u])},[t]),I=c.useCallback(o=>{if(!o.over)return;const u=o.over.id.split("-",2)[1]??null;K(t,u).catch(console.error)},[K,t]),U=J($(Y,{activationConstraint:{distance:10}}),$(X));c.useEffect(()=>{d(null).catch(console.error)},[d]),c.useEffect(()=>{j().catch(console.error)},[j]);const A=c.useMemo(()=>({users:s,selected:t,setSelected:a,addFolder:O,addMember:w,remove:N,rename:L,list:d,menu:m,setMenu:h}),[s,t,a,O,w,N,L,d,m,h]);return l.jsxs(R.Provider,{value:A,children:[l.jsx(D,{}),l.jsx(Q,{onDragStart:B,onDragEnd:I,sensors:U,children:e})]})}const W=()=>c.useContext(R),ue=Object.freeze(Object.defineProperty({__proto__:null,FinderWrapper:oe,default:W},Symbol.toStringTag,{value:"Module"}));export{ue as C,oe as F,de as M,W as u};
