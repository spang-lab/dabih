import{j as e,u as g,r as a,a as c}from"./index-D81WwACb.js";import{T as v}from"./Switch-BsbkrgHu.js";import{D as N}from"./Transition-D4OxtElp.js";import{q as K,z as S}from"./dialog-YppJ8AFh.js";import{C}from"./CreateKey-CFeMbgxx.js";import D from"./PublicKey-IfzGof5g.js";import{P as R}from"./plus-DkAvrrvl.js";import"./label-DeZCyrFp.js";import"./index-BLzTb_JD.js";import"./description-CHTAMN5B.js";import"./portal-CrkO56Jr.js";import"./Spinner-Br-E1HIG.js";import"./LocalDate-BIT0VlXU.js";import"./trash-2-DYQ5HbAl.js";function k({show:n,type:i,name:l,onSubmit:d,onClose:o}){return e.jsx(N,{show:n,onClose:o,children:e.jsxs(K,{className:"w-full max-w-md p-6 overflow-hidden text-left align-middle shadow-xl transform rounded-2xl transition-all border bg-gray-50 border-gray-300",children:[e.jsxs(S,{as:"h2",className:"text-2xl font-extrabold text-gray-800 leading-6",children:["Confirm",e.jsx("span",{className:"pl-2 text-red",children:"Deletion"})]}),e.jsxs("div",{className:"pt-2",children:["Are you sure you want to delete the"," ",e.jsx("span",{className:"font-semibold text-blue",children:i})]}),e.jsx("div",{className:"py-2 font-semibold text-blue",children:l}),e.jsxs("div",{className:"text-right",children:[e.jsx("button",{type:"button",className:"mx-3 px-2 py-1 text-gray-100 bg-red hover:text-white rounded-md",onClick:()=>{d(),o()},children:"Delete"}),e.jsx("button",{type:"button",className:"mx-3 px-2 py-1 text-white bg-gray-400 hover:text-white rounded-md",onClick:o,children:"Cancel"})]})]})})}function J(){const{user:n,update:i,isAdmin:l}=g(),[d,o]=a.useState([]),[m,y]=a.useState(!1),[u,x]=a.useState(null),[b,p]=a.useState(!1),r=a.useCallback(async()=>{const{data:s,error:t}=await c.user.list();t||o(s)},[]),f=async(s,t,h)=>{await c.user.enableKey({sub:s,hash:t,enabled:h}),await r(),await i()},w=async s=>{await c.user.removeKey(s),await r()},j=async s=>{n&&(await c.user.addKey({sub:n.sub,data:{...s},isRootKey:!0}),await r(),await i())};return a.useEffect(()=>{r().catch(console.error)},[r]),e.jsxs("div",{className:"py-2",children:[e.jsx(C,{show:b,onClose:()=>p(!1),onSubmit:s=>void j(s)}),e.jsx(k,{type:"public key",name:u?.hash??"",show:!!u,onSubmit:()=>void w(u),onClose:()=>x(null)}),e.jsxs("div",{className:"inline-flex items-center",children:[e.jsx(v,{enabled:m,onChange:()=>y(!m)}),e.jsx("span",{className:"px-2 font-bold",children:"Show only root keys"})]}),e.jsx("div",{className:"max-h-96 overflow-scroll",children:d.flatMap(s=>s.keys.map(t=>e.jsx(D,{publicKey:t,user:s,show:!m||t.isRootKey,isAdmin:l,onRemove:()=>x({sub:s.sub,hash:t.hash}),onEnable:h=>void f(s.sub,t.hash,h)},t.hash)))}),e.jsx("div",{hidden:!l,className:"m-2",children:e.jsx("button",{className:"px-2 py-1 bg-blue text-white rounded-lg disabled:opacity-50",type:"button",onClick:()=>p(!0),children:e.jsxs("span",{className:"whitespace-nowrap font-bold",children:[e.jsx(R,{className:"inline-block mr-2 mb-1",size:18}),"Generate a new root key"]})})})]})}export{J as default};
